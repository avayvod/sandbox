<!DOCTYPE  html>
<html>
<head>
<title>Permissions API test page</title>
<link rel='manifest' href='manifest.json'>
</head>
<body>
<h3>Permissions</h3>
<div><b></b>Geolocation:</b> <span id='geolocation'></span></div>
<div><b></b>Notifications:</b> <span id='notifications'></span></div>
<div><b></b>Midi:</b> <span id='midi'></span></div>
<div><b></b>Midi SysEx:</b> <span id='midi-sysex'></span></div>
<div><b></b>Push Notifications:</b> <span id='push-notifications'></span></div>

<fieldset>
  <legend>Requests</legend>
  <button onclick="navigator.geolocation.getCurrentPosition(function(){});">Geolocation</button>
  <button onclick="Notification.requestPermission();">Notifications</button>
  <button onclick="navigator.requestMIDIAccess({sysex:true});">Midi SysEx</button>
  <button onclick="requestPushPermission();">Push Notifications</button>
</fieldset>
</body>
<script>
  function requestPushPermission() {
    navigator.serviceWorker.register('/sandbox/sw-focus.js', {
      scope: '/sandbox/'
    }).then(function(reg) {
      return reg.pushManager.subscribe();
    }).then(function(reg) {
      console.log('push reg', reg);
    });
  }
</script>
<script>
  function refresh() {
    navigator.permissions.query({name:'geolocation'}).then(function(p) {
      document.getElementById('geolocation').textContent = p.status;
    });
    navigator.permissions.query({name:'notifications'}).then(function(p) {
      document.getElementById('notifications').textContent = p.status;
    });
    navigator.permissions.query({name:'midi', sysex:false}).then(function(p) {
      document.getElementById('midi').textContent = p.status;
    });
    navigator.permissions.query({name:'midi', sysex:true}).then(function(p) {
      document.getElementById('midi-sysex').textContent = p.status;
    });
    navigator.permissions.query({name:'push', userVisible:true}).then(function(p) {
      document.getElementById('push-notifications').textContent = p.status;
    });
  }
  // TODO: to be removed when the change event implementation is finished.
  setInterval(refresh, 1000);
</script>
</html>
